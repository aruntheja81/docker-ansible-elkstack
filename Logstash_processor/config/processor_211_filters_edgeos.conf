filter {
  if "EdgeOS" in [tags] and "pre-processed" not in [tags] {
    mutate {
      add_tag => [ "firewall" ]
    }
    grok {
      match => [
        "message", ".*\[%{NOTSPACE:fw_rule}]IN=%{NOTSPACE:in_interface} OUT=%{NOTSPACE:out_interface} MAC=%{NOTSPACE:mac_address} SRC=%{IPORHOST:src_ip} DST=%{IPORHOST:dst_ip} LEN=%{INT:packet_length} TOS=%{NOTSPACE:type_of_service} PREC=%{NOTSPACE:packet_precedence} TTL=%{INT:ttl} ID=%{INT:packet_id} %{WORD:fragment_flags} PROTO=%{WORD:proto} SPT=%{INT:src_port} DPT=%{INT:dst_port} WINDOW=%{INT:tcp_window_length} RES=%{NOTSPACE:reserved_bits} %{DATA:tcp_flags} URGP=%{INT:urgent_pointer}",
        "message", ".*\[%{NOTSPACE:fw_rule}]IN=%{NOTSPACE:in_interface} OUT=%{NOTSPACE:out_interface} MAC=%{NOTSPACE:mac_address} SRC=%{IPORHOST:src_ip} DST=%{IPORHOST:dst_ip} LEN=%{INT:packet_length} TOS=%{NOTSPACE:type_of_service} PREC=%{NOTSPACE:packet_precedence} TTL=%{INT:ttl} ID=%{INT:packet_id} PROTO=%{WORD:proto} SPT=%{INT:src_port} DPT=%{INT:dst_port} WINDOW=%{INT:tcp_window_length} RES=%{NOTSPACE:reserved_bits} %{DATA:tcp_flags} URGP=%{INT:urgent_pointer}",
        "message", ".*\[%{NOTSPACE:fw_rule}]IN=%{NOTSPACE:in_interface} OUT= MAC=%{NOTSPACE:mac_address} SRC=%{IPORHOST:src_ip} DST=%{IPORHOST:dst_ip} LEN=%{INT:packet_length} TOS=%{NOTSPACE:type_of_service} PREC=%{NOTSPACE:packet_precedence} TTL=%{INT:ttl} ID=%{INT:packet_id} %{WORD:fragment_flags} PROTO=%{WORD:proto} SPT=%{INT:src_port} DPT=%{INT:dst_port} WINDOW=%{INT:tcp_window_length} RES=%{NOTSPACE:reserved_bits} %{DATA:tcp_flags} URGP=%{INT:urgent_pointer}",
        "message", ".*\[%{NOTSPACE:fw_rule}]IN=%{NOTSPACE:in_interface} OUT= MAC=%{NOTSPACE:mac_address} SRC=%{IPORHOST:src_ip} DST=%{IPORHOST:dst_ip} LEN=%{INT:packet_length} TOS=%{NOTSPACE:type_of_service} PREC=%{NOTSPACE:packet_precedence} TTL=%{INT:ttl} ID=%{INT:packet_id} PROTO=%{WORD:proto} SPT=%{INT:src_port} DPT=%{INT:dst_port} WINDOW=%{INT:tcp_window_length} RES=%{NOTSPACE:reserved_bits} %{DATA:tcp_flags} URGP=%{INT:urgent_pointer}",
        "message", ".*\[%{NOTSPACE:fw_rule}]IN=%{NOTSPACE:in_interface} OUT= MAC=%{NOTSPACE:mac_address} SRC=%{IPORHOST:src_ip} DST=%{IPORHOST:dst_ip} LEN=%{INT:packet_length} TOS=%{NOTSPACE:type_of_service} PREC=%{NOTSPACE:packet_precedence} TTL=%{INT:ttl} ID=%{INT:packet_id} PROTO=%{WORD:proto} SPT=%{INT:src_port} DPT=%{INT:dst_port} LEN=%{INT:packet_length}",
        "message", ".*\[%{NOTSPACE:fw_rule}]IN=%{NOTSPACE:in_interface} OUT= MAC=%{NOTSPACE:mac_address} SRC=%{IPORHOST:src_ip} DST=%{IPORHOST:dst_ip} LEN=%{INT:packet_length} TOS=%{NOTSPACE:type_of_service} PREC=%{NOTSPACE:packet_precedence} TTL=%{INT:ttl} ID=%{INT:packet_id} PROTO=%{WORD:proto} TYPE=%{INT:icmp_type} CODE=%{INT:icmp_code} ID=%{INT:icmp_id} SEQ=%{INT:icmp_sequence}"
      ]
    }
  }
}
